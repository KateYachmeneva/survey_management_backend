{% extends 'base.html' %}
{% load static%}


{% block content %}
<style>
.nav-pills .nav-link.active, .nav-pills .show>.nav-link{
    color: var(--bs-nav-pills-link-active-color);
    background-color: #fdb30d;}

.link {
    text-decoration: none;
}

body{ overflow: hidden; }
</style>

<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <div class="container-fluid">
    <button class="btn btn-outline-secondary"
            type="button"
            data-bs-toggle="offcanvas"
            data-bs-target="#TreeNavBar"
            aria-controls="TreeNavBar">
      <span class="navbar-toggler-icon"></span>
    </button>
      <ul class="nav nav-pills m-auto">
        <li class="nav-item">
          {% if context.active == 'param' %}
          <a href="{% url 'param' %}" class="nav-link active" style="font-size:large">Общие параметры</a>
          {% else %}
          <a href="{% url 'param' %}" class="nav-link" style="font-size:large">Общие параметры</a>
          {% endif %}
        </li>
        <li class="nav-item active">
          {% if context.active == 'plan' %}
          <a href="{% url 'plan' %}" class="nav-link active" style="font-size:large">Плановая траектория</a>
          {% else %}
          <a href="{% url 'plan' %}" class="nav-link" style="font-size:large">Плановая траектория</a>
          {% endif %}
        </li>
        <li class="nav-item">
          {% if context.active == 'traj'%}
          <a href="{% url 'traj' %}" class="nav-link active" style="font-size:large">Траектории</a>
          {% else %}
          <a href="{% url 'traj' %}" class="nav-link" style="font-size:large">Траектории</a>
          {% endif %}
        </li>
      </ul>
  </div>
</nav>

<div class="row" style="margin: 0em;">
    {% block left_panel %}
    <div class="col-2">
        <!-- Дерево -->
        <div class="flex-shrink-0 p-3 bg-white" style="width: 280px;">
            <a href="/" class="d-flex align-items-center pb-3 mb-3 link-dark text-decoration-none border-bottom">
                <svg class="bi me-2" width="30" height="24"><use xlink:href="#bootstrap"></use></svg>
                <span class="fs-5 fw-semibold">Выбор модели</span>
            </a>
            <!-- Начало дерева(по id работаем с деревом в js) -->
            <ul class="list-unstyled ps-0" id="tree-menu">
                <!-- ДО -->
                {% for dict in context.tree %}
                <li class="mb-1">
                    <a class="btn btn-toggle align-items-center rounded collapsed " data-bs-toggle="collapse"
                       href="#{{ dict.client }}" role="button" aria-expanded="false">
                        {{ dict.client }}
                    </a>
                    <div class="collapse {% if dict.client == context.selected_client %} show {% endif %}" id="{{ dict.client }}" style="">
                        <ul class="btn-toggle-nav ">
                            <!-- Месторождение -->
                            {% for field_dict in dict.fields %}
                            <li><a href="#field{{field_dict.id}}" class="link-dark rounded field" data-toggle="collapse">
                                {{field_dict.field_name}}</a>
                                <div class="collapse {% if field_dict.field_name == context.selected_field %} show {% endif %}" id="field{{field_dict.id}}">
                                    <ul class="btn-toggle-nav">
                                        <!-- Куст -->
                                        {% for pad_dict in field_dict.pads %}
                                            <li><a href="#field{{field_dict.id}}pad{{pad_dict.id}}" class="link link-dark rounded pad" data-toggle="collapse">
                                                Куст {{pad_dict.pad_name}}</a>
                                                <div class="collapse {% if pad_dict.pad_name == context.selected_pad %} show {% endif %}" id="field{{field_dict.id}}pad{{pad_dict.id}}">
                                                    <ul class="btn-toggle-nav">
                                                        <!-- Скважина -->
                                                        {% for well_dict in pad_dict.wells %}
                                                        <li><a href="#field{{field_dict.id}}well{{well_dict.id}}" class="link link-dark rounded well" data-toggle="collapse">
                                                            Скв. {{well_dict.well_name}}</a>
                                                            <div class="collapse {% if well_dict.well_name == context.selected_well %} show {% endif %}" id="field{{field_dict.id}}well{{well_dict.id}}">
                                                                <ul class="btn-toggle-nav">
                                                                    <!-- Ствол-->
                                                                    {% for wellbore_dict in well_dict.wellbores %}
                                                                    <li><a href="#field{{field_dict.id}}_{{wellbore_dict.id}}" class="link link-dark rounded wellbore" data-toggle="collapse">
                                                                        Ствол {{wellbore_dict.wellbore}}</a>
                                                                        <div class="collapse {% if wellbore_dict.wellbore == context.selected_wellbore %} show {% endif %}" id="field{{field_dict.id}}_{{wellbore_dict.id}}">
                                                                            <ul class="btn-toggle-nav">
                                                                                <!-- Секция-->
                                                                                {% for section_dict in wellbore_dict.sections %}
                                                                                <li><a href="#field{{field_dict.id}}_{{section_dict.id}}" class="link link-dark rounded section" data-toggle="collapse">
                                                                                    {{section_dict.section}}</a>
                                                                                    <div class="collapse {% if well_dict.well_name == context.selected_well and section_dict.section == context.selected_section %} show {% endif %}" id="field{{field_dict.id}}_{{section_dict.id}}">
                                                                                        <ul class="btn-toggle-nav">
                                                                                            <!-- Рейс-->
                                                                                            {% for run_dict in section_dict.runs %}
                                                                                            <li><a href="?run_id={{run_dict.id}}" onclick="SetRun({{run_dict.id}})" class="run" {% if run_dict.run_number == context.selected_run and well_dict.well_name == context.selected_well and wellbore_dict.wellbore == context.selected_wellbore %} style="background-color: #fdb30d;" {% endif %}>{{run_dict.run_number}}</a></li>
                                                                                            {% endfor %}
                                                                                            <!-- Конец Рейс-->
                                                                                        </ul>
                                                                                    </div>
                                                                                </li>
                                                                                {% endfor %}
                                                                                <!-- Конец Секция-->
                                                                            </ul>
                                                                        </div>
                                                                    </li>
                                                                    {% endfor %}
                                                                    <!-- Конец Ствол -->
                                                                </ul>
                                                            </div>
                                                        </li>
                                                        {% endfor %}
                                                        <!-- Конец Скважина -->
                                                    </ul>
                                                </div>
                                            </li>
                                        {% endfor %}
                                        </li>
                                    </ul>
                                </div>
                            </li>
                            {% endfor %}

                        </ul>
                    </div>
                </li>
                <!-- !Клиент -->
                {% endfor %}
          </ul>
      </div>

    </div>
    {% endblock %}


  <!--  НОВОЕ ДЕРЕВО -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="TreeNavBar">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="offcanvasNavbarLabel">
        Выбор модели
      </h5>
      <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <input class="form-control me-2" type="search" placeholder="Поиск(в разработке)">
      <br>
      {% for dict in context.tree %}
      <div class="DO" id='tree'>
          <button class="collapsed btn btn-toggle" data-bs-toggle="collapse" onclick="SetClient({{dict.id}})" href="#Client{{dict.id}}">
          {{dict.client}}
        </button>
          <ul class="collapse" id="Client{{dict.id}}">
            {% for field_dict in dict.fields %}
            <!--      Месторождение      -->
            <li style="cursor: pointer;"><span class="collapsed" data-bs-toggle="collapse" onclick="SetField({{field_dict.id}})" href="#Field{{field_dict.id}}">
              {{field_dict.field_name}}</span>
              <ul class="collapse" id="Field{{field_dict.id}}">
                {% for pad_dict in field_dict.pads %}
                <!--      Куст      -->
                <li style="cursor: pointer;"><span  class="collapsed" data-bs-toggle="collapse" onclick="SetPad({{pad_dict.id}})" href="#Pad{{pad_dict.id}}">Куст {{pad_dict.pad_name}}</span>
                  <ul class="collapse" id="Pad{{pad_dict.id}}">
                    {% for well_dict in pad_dict.wells %}
                    <!--      Скважина      -->
                    <li style="cursor: pointer;"><span  class="collapsed" data-bs-toggle="collapse" onclick="SetWell({{well_dict.id}})" href="#Well{{well_dict.id}}">Скв. {{well_dict.well_name}}</span>
                      <ul class="collapse" id="Well{{well_dict.id}}">
                        {% for wellbore_dict in well_dict.wellbores %}
                        <!--      Ствол     -->
                        <li style="cursor: pointer;"><span  class="collapsed" data-bs-toggle="collapse" onclick="SetWellbore({{wellbore_dict.id}})" href="#Wellbore{{wellbore_dict.id}}">Ствол {{wellbore_dict.wellbore}}</span>
                          <ul class="collapse" id="Wellbore{{wellbore_dict.id}}">
                            {% for section_dict in wellbore_dict.sections %}
                            <!--      Секция      -->
                            <li style="cursor: pointer;"><span  class="collapsed" data-bs-toggle="collapse" onclick="SetSection({{section_dict.id}})" href="#Section{{section_dict.id}}">{{section_dict.section}}</span>
                              <ul class="collapse run" id="Section{{section_dict.id}}">
                                {% for run_dict in section_dict.runs %}
                                <!--      Рейс      -->
                                <li style="cursor: pointer;"><a href="?run_id={{run_dict.id}}" id='Run{{run_dict.id}}' onclick="SetRun({{run_dict.id}})" class="run"> Рейс {{run_dict.run_number}} </a>
                                </li>
                                {% endfor %}
                              </ul>
                            </li>
                            {% endfor %}
                          </ul>
                        </li>
                        {% endfor %}
                      </ul>
                    </li>
                    {% endfor %}
                  </ul>
                </li>
                {% endfor %}
              </ul>
            </li>
            {% endfor %}
          </ul>
      </div>
      {% endfor %}
    </div>
  </div>
    <div class="col">
      {% block data %}
      {% endblock %}
    </div>
  </div>


<script src="{% static 'js/nav_menu.js'%}"></script>

<script>
<!-- Новое дерево открываем выбранный элемент -->
window.addEventListener('load', () => {
  console.log(data);
  var selected_run = document.getElementById('Run'+ sessionStorage.getItem("run_id"));
  console.log(selected_run)
  selected_run.parentNode.style.background = "linear-gradient(to right, yellow 40%, transparent 80%)";
  selected_run.classList.add('show');
  selected_run.parentNode.parentNode.classList.add('show');
  selected_run.parentNode.parentNode.parentNode.parentNode.classList.add('show');
  selected_run.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.classList.add('show');
  selected_run.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.classList.add('show');
  selected_run.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.classList.add('show');
  selected_run.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.classList.add('show');
  selected_run.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.classList.add('show');
  selected_run.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode.style.background= "linear-gradient(to right, yellow 1%, transparent 5%)";
});


<!-- Записываем в session storage объекты которые храним -->
function SetClient(id){
    sessionStorage.setItem("client_id", id)
}

function SetField(id){
    sessionStorage.setItem("field_id", id)
}

function SetPad(id){
    sessionStorage.setItem("pad_id", id)
}

function SetWell(id){
    sessionStorage.setItem("well_id", id)
}

function SetWellbore(id){
    sessionStorage.setItem("wellbore_id", id)
}

function SetSection(id){
    sessionStorage.setItem("section_id", id)
}

function SetRun(id){
    sessionStorage.setItem("run_id", id)
}
</script>
{% endblock %}

